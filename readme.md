# 3D 애니메이션 + 모션


[우리가 필요한 프로그램](https://www.notion.so/e76f908d310d447c8fcb1402166216ef)

## 준비물

MMD 에서 사용되는 확장자인 .pmx 파일을 언리얼에서 불러와 작업하기 위함이다. 추가로 .vmd 파일도 적용해서 MV영상을 만드는것을 목표로 한다. 

### 문제점

언리얼엔진에서는 공식적으로 PMX파일을 입포트할 수 있는 방법이 없다. 하지만 비공식적으로 IM4U 모듈을 사용해 PMX파일을 임포트할 수 있게 되었다.

하지만 최신 버전에 대응하는 플러그인이 없다. 따라서 아래의 절차를 거쳐 PMX파일을 임포트 할 필요가 있다.

1. pmx파일을 fbx 파일로 변환한다.
2. 변환할때 .vmd 파일을 애님시퀀스로 변환한다.
3. 엔진에 가져와서 뚱땅뚱땅 거려본다.

이번에 우리가 따라할 퀄리티는 아래 영상이다

[https://youtu.be/OwqgqZHcskc](https://youtu.be/OwqgqZHcskc)

## 실전으로 가자.

### pmx 파일 찾기

이미 만든 VRM을 PMX로 만들어도 되고, FBX로 만들어도 된다. 만약 FBX로 만들었다면 준비성이 철저한 당신에게 👍 치얼스!

만약 3D 캐릭터 파일이 없다면 아래 링크에서 다운로드 받을 수 있다.

[https://3d.nicovideo.jp/](https://3d.nicovideo.jp/)

니코니코 동화에서 3D 모델 데이터를 공유하는 사이트가 있다. 본 사이트에서 검증된 모델을 사용하여 MMD에서 먼저 작동하는지 확인하자.

![3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled.png](3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled.png)

pmx파일과 텍스쳐 파일이 있는지 확인하고, 다음은 vmd라는 모션 데이터를 다운로드 할 차례.
참고로 애니메이션 없이 모델 데이터만 불러올거면 다운로드 할 필요는 없지만.. 우리는 위에 있는 퀄리티 처럼 작업할 것이다.

### vmd 파일 다운로드

유튜브에서 MMD 를 통해 만든 영상들은 모션 데이터를 을 다운로드 할 수 있도록 공유 하기도 한다.
위 방법처럼 파일을 찾거나 유튜브에서 곡이름 + vmd download를 입력해서 다운로드할 수 있는 프로젝트가 간혹 있다.

### pmx 파일을 fbx파일로 변환

PMX2FBX라는 프로그램을 이용해서 fbx파일로 변환하려고 한다, 아래 파일을 다운로드 받는다.

[PmxToFbx.zip](3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/PmxToFbx.zip)

다운로드를 마쳤다면 압축을 풀고 명령프롬프트를 열어 다운로드 한 파일의 경로로 이동한다.

![3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled%201.png](3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled%201.png)

만약, 프로그램이 C가 아닌 D, F G 등에 있다면 전체 경로를 cd로 복붙하여 이동하기 전에 G:\와 같은 명령어를 통해 디렉토리를 먼저 스위칭 해주자.

여기서 아래의 명령어를 실행하면 되는데 본인의 파일 경로에 맞게 입력해야한다. 만약 .vmd 파일이 없다면 두번째 인자값을 입력하지 않아도 된다.

```
Pmx2Fbx.exe Path/To/Pmx Path/To/Vmd
예)
Pmx2Fbx.exe G:\Unreal_character\model_files\dot_rockingstone\roc_model.pmx G:\Unreal_character\motions\01-hibikase_motion.vmd

```

오류가 발생하나요?

**파일 이름 또는 경로에 일본어가 적혀있는 경우** 제대로 실행되지 않아요.
**모두 영어로 변경해주고 실행**해주세요.

![3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled%202.png](3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled%202.png)

실행할 때 모핑을 찾지 못한다고 해도 넘겨주자. 애니메이션 파일 또는 모델 파일 크기에 따라서 다소 시간이 걸릴 수 있으니 끝날 때 까지 기다리도록 하자.

만약 애니메이션 내보내기가 모두 끝난 경우 아래 화면처럼 완료되었다고 나온다.

![3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled%203.png](3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled%203.png)

그리고 원래 모델 파일인 pmx가 있는 위치에 하이라이트 처리된 두개의 파일이 존재한다.

![3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled%204.png](3D%20%E1%84%8B%E1%85%A2%E1%84%82%E1%85%B5%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%20+%20%E1%84%86%E1%85%A9%E1%84%89%E1%85%A7%E1%86%AB%2074a1198c7f27488d8b1e1c4b9b146853/Untitled%204.png)

이로써 PMX와 VMD 파일을 하나의 FBX 파일로 변환했다.

### 언리얼로 임포트 하기

적당히 프로젝트를 생성한다. 간단한 MV를 위해서는 샘플 맵을 가져와도 된다. (맵 프로젝트를 실행해도 된다.)

프로젝트에 맵을 추가 하기 위해서 Epic Store에 있는 Map asset을 구매한 다음
프로젝트를 생성하고, 어셋을 프로젝트에 추가 시켜야 한다.

이제 언리얼 프로젝트에서 새 폴더를 만들고 이전에 뽑은 FBX 파일을 프로젝트로 임포트한다.
임포트 할때 몇가지 사항을 설정해야한다.

- Skeletal Mesh (체크)
- Import Morph Targets (체크)
- Import Animations (체크)
- Animation Length (Exported Time → 이거는 변경하면 아작남.. 왠지 아시죠...?)
- 머티리얼 임포트 메서드 (머티리얼 생성하지 않음)
- Import Texture (체크 해제) 텍스쳐는 호환성 문제로 인해 읽을 수 없으니 ㅋ 가져와봤자 의미 없음

크기(Scale)은 모델마다 다르지만 대부분 크게 나온다. 블렌더 기준이지만 0.2로 설정하면 적당했으니 참고한다.

물론, 직접 임포트 해보고 차이가 너무 난다면 임포트 한 파일을 지우고, 크기를 재 조정하여 임포트 하면 문제 없이 사용할 수 있을 것.

### 만약 임포트 후 스켈레톤 매쉬와 텍스쳐가 보이지 않는 경우?

열심히 작업했지만, 텍스쳐가 보이지 않는 당신을 위해..

UE4에서는 PMX파일을 읽을 수 없어서, 4.16버전에 한해서 IM4U 플러그인을 사용하여 PMX를 fbx로 바로 임포팅하는 BF 플러그인이 있다.

해당 플러그인으로 PMX파일을 바로 임포트 해보기 바란다.

그리고, 거기서 불러온 모든 스켈레톤 텍스쳐를 Pmx2Fbx.exe로 변경한 스켈레탈 빈 매쉬에 업데이트 해주면 끝!